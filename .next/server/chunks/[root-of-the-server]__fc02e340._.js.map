{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Clementine/Desktop/bill-distribution-system/lib/db.ts"],"sourcesContent":["import Database from 'better-sqlite3';\r\nimport path from 'path';\r\n\r\nconst dbPath = path.join(process.cwd(), 'data', 'bill_system.db');\r\nconst db = new Database(dbPath);\r\n\r\nexport default db;\r\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEA,MAAM,SAAS,iGAAA,CAAA,UAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;AAChD,MAAM,KAAK,IAAI,2HAAA,CAAA,UAAQ,CAAC;uCAET","debugId":null}},
    {"offset": {"line": 92, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Clementine/Desktop/bill-distribution-system/app/api/manager/projects/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport db from '@/lib/db';\r\n\r\nexport async function GET(req: NextRequest) {\r\n  // ⚠️ 实际开发中你应该根据当前 session 提取 manager_id\r\n  const projects = db.prepare(`SELECT * FROM projects WHERE manager_id = ?`).all(1); // 这里写死为 1\r\n\r\n  for (const project of projects) {\r\n    const assignments = db.prepare(`\r\n      SELECT * FROM project_assignments WHERE project_id = ?\r\n    `).all(project.id);\r\n    project.assignments = assignments;\r\n  }\r\n\r\n  return NextResponse.json(projects);\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    const { title, episode, language, minutes, deadline, assignments } = body;\r\n\r\n    // 基本字段校验\r\n    if (!title || !episode || !language || !minutes || !deadline || !assignments) {\r\n      return NextResponse.json({ error: '字段不完整' }, { status: 400 });\r\n    }\r\n\r\n    // 插入项目\r\n    const projectStmt = db.prepare(`\r\n      INSERT INTO projects (title, episode, language, minutes, deadline, manager_id)\r\n      VALUES (?, ?, ?, ?, ?, ?)\r\n    `);\r\n    const result = projectStmt.run(title, episode, language, minutes, deadline, 1); // 假设 manager_id = 1\r\n    const projectId = result.lastInsertRowid as number;\r\n\r\n    // 准备插入任务分配\r\n    const assignStmt = db.prepare(`\r\n      INSERT INTO project_assignments (project_id, member_id, role, minutes, status, deadline)\r\n      VALUES (?, ?, ?, ?, ?, ?)\r\n    `);\r\n\r\n    for (const [role, memberId] of Object.entries(assignments)) {\r\n      if (!memberId || isNaN(Number(memberId))) {\r\n        return NextResponse.json({ error: `无效的接单员ID（${role}）` }, { status: 400 });\r\n      }\r\n\r\n      assignStmt.run(\r\n        projectId,\r\n        Number(memberId),\r\n        role,\r\n        minutes / 4,\r\n        'pending',\r\n        deadline\r\n      );\r\n    }\r\n\r\n    return NextResponse.json({ ok: true, id: projectId });\r\n  } catch (error) {\r\n    console.error('创建项目失败:', error);\r\n    return NextResponse.json({ error: '内部错误' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,GAAgB;IACxC,wCAAwC;IACxC,MAAM,WAAW,2GAAA,CAAA,UAAE,CAAC,OAAO,CAAC,CAAC,2CAA2C,CAAC,EAAE,GAAG,CAAC,IAAI,UAAU;IAE7F,KAAK,MAAM,WAAW,SAAU;QAC9B,MAAM,cAAc,2GAAA,CAAA,UAAE,CAAC,OAAO,CAAC,CAAC;;IAEhC,CAAC,EAAE,GAAG,CAAC,QAAQ,EAAE;QACjB,QAAQ,WAAW,GAAG;IACxB;IAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;AAC3B;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,QAAQ,EAAE,OAAO,EAAE,QAAQ,EAAE,WAAW,EAAE,GAAG;QAErE,SAAS;QACT,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,YAAY,CAAC,WAAW,CAAC,YAAY,CAAC,aAAa;YAC5E,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAQ,GAAG;gBAAE,QAAQ;YAAI;QAC7D;QAEA,OAAO;QACP,MAAM,cAAc,2GAAA,CAAA,UAAE,CAAC,OAAO,CAAC,CAAC;;;IAGhC,CAAC;QACD,MAAM,SAAS,YAAY,GAAG,CAAC,OAAO,SAAS,UAAU,SAAS,UAAU,IAAI,oBAAoB;QACpG,MAAM,YAAY,OAAO,eAAe;QAExC,WAAW;QACX,MAAM,aAAa,2GAAA,CAAA,UAAE,CAAC,OAAO,CAAC,CAAC;;;IAG/B,CAAC;QAED,KAAK,MAAM,CAAC,MAAM,SAAS,IAAI,OAAO,OAAO,CAAC,aAAc;YAC1D,IAAI,CAAC,YAAY,MAAM,OAAO,YAAY;gBACxC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;oBAAE,OAAO,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;gBAAC,GAAG;oBAAE,QAAQ;gBAAI;YACzE;YAEA,WAAW,GAAG,CACZ,WACA,OAAO,WACP,MACA,UAAU,GACV,WACA;QAEJ;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM,IAAI;QAAU;IACrD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,WAAW;QACzB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAO,GAAG;YAAE,QAAQ;QAAI;IAC5D;AACF","debugId":null}}]
}