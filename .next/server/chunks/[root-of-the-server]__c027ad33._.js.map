{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 132, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Clementine/Desktop/bill-distribution-system/lib/db.ts"],"sourcesContent":["import Database from 'better-sqlite3';\r\nimport path from 'path';\r\n\r\nconst dbPath = path.join(process.cwd(), 'data', 'bill_system.db');\r\nconst db = new Database(dbPath);\r\n\r\nexport default db;\r\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEA,MAAM,SAAS,iGAAA,CAAA,UAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;AAChD,MAAM,KAAK,IAAI,2HAAA,CAAA,UAAQ,CAAC;uCAET","debugId":null}},
    {"offset": {"line": 148, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Clementine/Desktop/bill-distribution-system/app/api/manager/projects/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { getToken } from 'next-auth/jwt';\r\nimport db from '@/lib/db';\r\n\r\nconst secret = process.env.NEXTAUTH_SECRET;\r\n\r\nexport async function GET(req: NextRequest) {\r\n  const token = await getToken({ req, secret });\r\n  const user = token;\r\n\r\n  if (!user || user.role !== 'manager') {\r\n    return NextResponse.json({ error: 'Êó†ÊùÉÈôê' }, { status: 403 });\r\n  }\r\n\r\n  const projects = db\r\n    .prepare(`SELECT * FROM projects WHERE manager_id = ?`)\r\n    .all(user.id);\r\n\r\n  for (const project of projects) {\r\n    const assignments = db\r\n      .prepare(`SELECT * FROM project_assignments WHERE project_id = ?`)\r\n      .all(project.id);\r\n    project.assignments = assignments;\r\n  }\r\n\r\n  return NextResponse.json(projects);\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const token = await getToken({ req, secret });\r\n    console.log('üì¶ ÂΩìÂâçÁôªÂΩï token:', token);\r\n\r\n    const user = token;\r\n\r\n    if (!user || user.role !== 'manager') {\r\n      return NextResponse.json({ error: 'Êó†ÊùÉÈôê' }, { status: 403 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const { title, episode, language, minutes, deadline, assignments } = body;\r\n\r\n    if (!title || !episode || !language || !minutes || !deadline || !assignments) {\r\n      return NextResponse.json({ error: 'Â≠óÊÆµ‰∏çÂÆåÊï¥' }, { status: 400 });\r\n    }\r\n\r\n    const result = db.prepare(`\r\n      INSERT INTO projects (title, episode, language, minutes, deadline, manager_id)\r\n      VALUES (?, ?, ?, ?, ?, ?)\r\n    `).run(title, episode, language, minutes, deadline, user.id);\r\n\r\n    const projectId = result.lastInsertRowid as number;\r\n\r\n    const assignStmt = db.prepare(`\r\n      INSERT INTO project_assignments (project_id, member_id, role, minutes, status, deadline)\r\n      VALUES (?, ?, ?, ?, ?, ?)\r\n    `);\r\n\r\n    for (const [role, memberId] of Object.entries(assignments)) {\r\n      assignStmt.run(projectId, Number(memberId), role, minutes / 4, 'pending', deadline);\r\n    }\r\n\r\n    return NextResponse.json({ ok: true });\r\n  } catch (error) {\r\n    console.error('ÂàõÂª∫È°πÁõÆÂ§±Ë¥•:', error);\r\n    return NextResponse.json({ error: 'ÂÜÖÈÉ®ÈîôËØØ' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,eAAe;AAEnC,eAAe,IAAI,GAAgB;IACxC,MAAM,QAAQ,MAAM,CAAA,GAAA,8IAAA,CAAA,WAAQ,AAAD,EAAE;QAAE;QAAK;IAAO;IAC3C,MAAM,OAAO;IAEb,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,WAAW;QACpC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAM,GAAG;YAAE,QAAQ;QAAI;IAC3D;IAEA,MAAM,WAAW,2GAAA,CAAA,UAAE,CAChB,OAAO,CAAC,CAAC,2CAA2C,CAAC,EACrD,GAAG,CAAC,KAAK,EAAE;IAEd,KAAK,MAAM,WAAW,SAAU;QAC9B,MAAM,cAAc,2GAAA,CAAA,UAAE,CACnB,OAAO,CAAC,CAAC,sDAAsD,CAAC,EAChE,GAAG,CAAC,QAAQ,EAAE;QACjB,QAAQ,WAAW,GAAG;IACxB;IAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;AAC3B;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,QAAQ,MAAM,CAAA,GAAA,8IAAA,CAAA,WAAQ,AAAD,EAAE;YAAE;YAAK;QAAO;QAC3C,QAAQ,GAAG,CAAC,kBAAkB;QAE9B,MAAM,OAAO;QAEb,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,WAAW;YACpC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAM,GAAG;gBAAE,QAAQ;YAAI;QAC3D;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,QAAQ,EAAE,OAAO,EAAE,QAAQ,EAAE,WAAW,EAAE,GAAG;QAErE,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,YAAY,CAAC,WAAW,CAAC,YAAY,CAAC,aAAa;YAC5E,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAQ,GAAG;gBAAE,QAAQ;YAAI;QAC7D;QAEA,MAAM,SAAS,2GAAA,CAAA,UAAE,CAAC,OAAO,CAAC,CAAC;;;IAG3B,CAAC,EAAE,GAAG,CAAC,OAAO,SAAS,UAAU,SAAS,UAAU,KAAK,EAAE;QAE3D,MAAM,YAAY,OAAO,eAAe;QAExC,MAAM,aAAa,2GAAA,CAAA,UAAE,CAAC,OAAO,CAAC,CAAC;;;IAG/B,CAAC;QAED,KAAK,MAAM,CAAC,MAAM,SAAS,IAAI,OAAO,OAAO,CAAC,aAAc;YAC1D,WAAW,GAAG,CAAC,WAAW,OAAO,WAAW,MAAM,UAAU,GAAG,WAAW;QAC5E;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,IAAI;QAAK;IACtC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,WAAW;QACzB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAO,GAAG;YAAE,QAAQ;QAAI;IAC5D;AACF","debugId":null}}]
}