(()=>{var e={};e.id=950,e.ids=[950],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31449:(e,r,s)=>{"use strict";s.r(r),s.d(r,{patchFetch:()=>b,routeModule:()=>E,serverHooks:()=>R,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>g});var t={};s.r(t),s.d(t,{DELETE:()=>l,GET:()=>p,PATCH:()=>m,POST:()=>d});var a=s(96559),n=s(48088),i=s(37719),u=s(32190),o=s(77460);async function p(e){let{searchParams:r}=new URL(e.url),s=r.get("memberId");if(s){let e=o.A.prepare(`SELECT id, language, task, price, rating
           FROM member_skills
          WHERE member_id = ?`).all(Number(s));return u.NextResponse.json({skills:e})}let t=r.get("name")??r.get("keyword")??"",a=t?"WHERE name LIKE ?":"",n=t?[`%${t}%`]:[],i=o.A.prepare(`SELECT id, username, name, phone, email, status
         FROM manager_users ${a}`).all(...n),p=o.A.prepare(`SELECT id, username, name, phone, email, status
         FROM member_users ${a}`).all(...n);return u.NextResponse.json({managers:i,members:p})}async function m(e){let{id:r,role:s,skills:t=[],...a}=await e.json(),n=Object.keys(a);if(n.length){let e=n.map(e=>`${e} = ?`).join(", "),t=n.map(e=>a[e]);o.A.prepare(`UPDATE ${"manager"===s?"manager_users":"member_users"} SET ${e} WHERE id = ?`).run(...t,r)}if("member"===s&&Array.isArray(t)&&(o.A.prepare("DELETE FROM member_skills WHERE member_id = ?").run(r),t.length)){let e=o.A.prepare(`INSERT INTO member_skills
           (member_id, language, task, price, rating)
         VALUES (?, ?, ?, ?, ?)`);o.A.transaction(s=>{s.forEach(s=>e.run(r,s.language,s.task,s.price,s.rating))})(t)}return u.NextResponse.json({ok:!0})}async function l(e){let{id:r,role:s,adminPassword:t}=await e.json();return o.A.prepare("SELECT id FROM admin_users WHERE password = ?").get(t)?(o.A.prepare(`DELETE FROM ${"manager"===s?"manager_users":"member_users"} WHERE id = ?`).run(r),u.NextResponse.json({ok:!0})):u.NextResponse.json({error:"密码错误"},{status:401})}async function d(e){let{role:r,user:s,skills:t}=await e.json(),a=o.A.prepare(`INSERT INTO ${"manager"===r?"manager_users":"member_users"}
         (username, password, name, phone, email, status)
       VALUES (?, ?, ?, ?, ?, ?)`).run(s.username,s.password,s.name,s.phone,s.email,s.status||"active");if("member"===r&&t?.length){let e=a.lastInsertRowid,r=o.A.prepare(`INSERT INTO member_skills
         (member_id, language, task, price, rating)
       VALUES (?, ?, ?, ?, ?)`);o.A.transaction(s=>{s.forEach(s=>r.run(e,s.language,s.task,s.price,s.rating))})(t)}return u.NextResponse.json({ok:!0})}let E=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/admin/users/route",pathname:"/api/admin/users",filename:"route",bundlePath:"app/api/admin/users/route"},resolvedPagePath:"E:\\offer\\test\\bill-distribution-system\\app\\api\\admin\\users\\route.ts",nextConfigOutput:"",userland:t}),{workAsyncStorage:c,workUnitAsyncStorage:g,serverHooks:R}=E;function b(){return(0,i.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:g})}},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},77460:(e,r,s)=>{"use strict";s.d(r,{A:()=>u});let t=require("better-sqlite3");var a=s.n(t),n=s(33873);let i=s.n(n)().join(process.cwd(),"data","bill_system.db"),u=new(a())(i)},78335:()=>{},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[243,580],()=>s(31449));module.exports=t})();