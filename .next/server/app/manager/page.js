(()=>{var e={};e.id=50,e.ids=[50],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8402:(e,s,t)=>{"use strict";t.d(s,{Providers:()=>n});var r=t(60687),a=t(82136);function n({children:e}){return(0,r.jsx)(a.SessionProvider,{children:e})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13081:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"E:\\\\offer\\\\test\\\\bill-distribution-system\\\\app\\\\manager\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"E:\\offer\\test\\bill-distribution-system\\app\\manager\\page.tsx","default")},14501:(e,s,t)=>{Promise.resolve().then(t.bind(t,8402))},18860:(e,s,t)=>{Promise.resolve().then(t.bind(t,84835))},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},46055:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});var r=t(31658);let a=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,r.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]},52765:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>x,tree:()=>o});var r=t(65239),a=t(48088),n=t(88170),i=t.n(n),l=t(30893),d={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);t.d(s,d);let o={children:["",{children:["manager",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,13081)),"E:\\offer\\test\\bill-distribution-system\\app\\manager\\page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,58014)),"E:\\offer\\test\\bill-distribution-system\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["E:\\offer\\test\\bill-distribution-system\\app\\manager\\page.tsx"],m={require:t,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/manager/page",pathname:"/manager",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},55308:(e,s,t)=>{Promise.resolve().then(t.bind(t,13081))},58014:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>i,metadata:()=>n});var r=t(37413);t(82704);var a=t(78972);let n={title:"字幕组项目管理系统",description:"管理项目、人员与账单的系统"};function i({children:e}){return(0,r.jsx)("html",{lang:"zh-CN",children:(0,r.jsx)("body",{className:"bg-white text-gray-800",children:(0,r.jsx)(a.Providers,{children:e})})})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66893:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,86346,23)),Promise.resolve().then(t.t.bind(t,27924,23)),Promise.resolve().then(t.t.bind(t,35656,23)),Promise.resolve().then(t.t.bind(t,40099,23)),Promise.resolve().then(t.t.bind(t,38243,23)),Promise.resolve().then(t.t.bind(t,28827,23)),Promise.resolve().then(t.t.bind(t,62763,23)),Promise.resolve().then(t.t.bind(t,97173,23))},78053:(e,s,t)=>{Promise.resolve().then(t.bind(t,78972))},78972:(e,s,t)=>{"use strict";t.d(s,{Providers:()=>r});let r=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call Providers() from the server but Providers is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"E:\\offer\\test\\bill-distribution-system\\app\\providers.tsx","Providers")},79551:e=>{"use strict";e.exports=require("url")},82704:()=>{},84835:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c});var r=t(60687),a=t(43210),n=t.n(a),i=t(82136);let l=["翻译","质检","后期","审核"],d=new Date().toISOString().split("T")[0],o=e=>{switch(e){case"请重新分配任务":case"超时未完成":return"text-red-600";case"待验收":return"text-green-600";case"分配中":return"text-blue-600";case"进行中":return"text-yellow-600";default:return""}};function c(){let{data:e,status:s}=(0,i.useSession)(),[t,c]=(0,a.useState)([]),[m,x]=(0,a.useState)([]),[p,h]=(0,a.useState)(!1),[u,b]=(0,a.useState)(""),[j,g]=(0,a.useState)(null),[v,f]=(0,a.useState)(!1),[N,y]=(0,a.useState)({title:"",episode:"",language:"日语",minutes:0,deadline:d,assignments:l.reduce((e,s)=>({...e,[s]:""}),{})}),[P,w]=(0,a.useState)({翻译:"",质检:"",后期:"",审核:""}),[C,S]=(0,a.useState)({翻译:[],质检:[],后期:[],审核:[]}),k=async()=>{let e=await fetch(`/api/admin/users?name=${encodeURIComponent(u)}`);x((await e.json()).members)},_=async()=>{try{let e=await fetch("/api/manager/projects");if(!e.ok)throw Error();let s=await e.json();c(Array.isArray(s)?s:[]),h(!1)}catch{c([]),h(!0)}};async function E(e,s=""){let t=`/api/manager/projects?language=${encodeURIComponent(N.language)}&task=${encodeURIComponent(e)}&keyword=${encodeURIComponent(s)}`,r=await fetch(t),a=await r.json();S(s=>({...s,[e]:a.members??[]}))}let $=async()=>{try{if(!(await fetch("/api/manager/projects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N)})).ok)throw Error();f(!1),y({title:"",episode:"",language:"日语",minutes:0,deadline:d,assignments:l.reduce((e,s)=>({...e,[s]:""}),{})}),_()}catch{alert("创建失败，请检查字段！")}},q=async e=>{confirm("确认项目所有任务正确完成并验收？")&&((await fetch("/api/manager/projects",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e})})).ok?_():alert("验收失败！"))},A=t.filter(e=>0===e.accepted),I=t.filter(e=>1===e.accepted);return"loading"===s?(0,r.jsx)("div",{children:"加载中..."}):e&&"manager"===e.user.role?(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsxs)("div",{children:["当前登录：",(0,r.jsx)("strong",{children:e.user.name}),"（项目经理）"]}),(0,r.jsx)("button",{className:"bg-red-500 text-white px-4 py-2 rounded",onClick:()=>(0,i.signOut)({callbackUrl:"/login"}),children:"退出登录"})]}),(0,r.jsx)("h2",{className:"text-xl font-bold mb-2",children:"接单员管理"}),(0,r.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,r.jsx)("input",{placeholder:"搜索姓名",value:u,onChange:e=>b(e.target.value),className:"border px-2 py-1"}),(0,r.jsx)("button",{className:"bg-gray-600 text-white px-4 py-1 rounded",onClick:k,children:"搜索"})]}),(0,r.jsxs)("table",{className:"table-auto w-full border-collapse border mb-8",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-100",children:[(0,r.jsx)("th",{className:"border px-2",children:"用户名"}),(0,r.jsx)("th",{className:"border px-2",children:"姓名"}),(0,r.jsx)("th",{className:"border px-2",children:"状态"}),(0,r.jsx)("th",{className:"border px-2",children:"操作"})]})}),(0,r.jsx)("tbody",{children:m.map(e=>(0,r.jsxs)("tr",{className:"frozen"===e.status?"text-gray-400":"",children:[(0,r.jsx)("td",{className:"border px-2",children:e.username}),(0,r.jsx)("td",{className:"border px-2",children:e.name}),(0,r.jsx)("td",{className:"border px-2",children:e.status}),(0,r.jsx)("td",{className:"border px-2",children:(0,r.jsx)("button",{className:"bg-yellow-500 text-white px-2 py-1 rounded",onClick:()=>toggleStatus(e.id,e.status),children:"切换状态"})})]},e.id))})]}),(0,r.jsx)("h2",{className:"text-xl font-bold mb-2",children:"待完成的项目"}),p?(0,r.jsx)("div",{className:"text-red-600 mb-4",children:"⚠️ 加载项目失败，可能无权限或服务器异常"}):0===A.length?(0,r.jsx)("div",{className:"text-gray-500 mb-8",children:"暂无待完成项目"}):(0,r.jsxs)("table",{className:"table-auto w-full border-collapse border mb-8",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-100",children:[(0,r.jsx)("th",{className:"border px-2",children:"名称"}),(0,r.jsx)("th",{className:"border px-2",children:"集数"}),(0,r.jsx)("th",{className:"border px-2",children:"语言"}),(0,r.jsx)("th",{className:"border px-2",children:"分钟数"}),(0,r.jsx)("th",{className:"border px-2",children:"截止日期"}),(0,r.jsx)("th",{className:"border px-2",children:"状态"}),(0,r.jsx)("th",{className:"border px-2",children:"操作"})]})}),(0,r.jsx)("tbody",{children:A.map(e=>(0,r.jsxs)(n().Fragment,{children:[(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"border px-2",children:e.title}),(0,r.jsx)("td",{className:"border px-2",children:e.episode}),(0,r.jsx)("td",{className:"border px-2",children:e.language}),(0,r.jsx)("td",{className:"border px-2",children:e.minutes}),(0,r.jsx)("td",{className:"border px-2",children:e.deadline}),(0,r.jsx)("td",{className:"border px-2 font-semibold",children:(0,r.jsx)("span",{className:o(e.projectStatus),children:e.projectStatus})}),(0,r.jsxs)("td",{className:"border px-2",children:[(0,r.jsx)("button",{className:"bg-blue-500 text-white px-2 py-1 rounded",onClick:()=>g(j===e.id?null:e.id),children:j===e.id?"收起":"展开"}),"待验收"===e.projectStatus&&(0,r.jsx)("button",{className:"bg-green-600 text-white px-2 py-1 rounded ml-2",onClick:()=>q(e.id),children:"验收"})]})]}),j===e.id&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:7,className:"border px-2 bg-gray-50",children:e.assignments.map(e=>(0,r.jsxs)("div",{className:"text-sm mb-1",children:[(0,r.jsx)("strong",{children:e.role}),"：",e.member_name,"， 状态 ",e.status,"， 完成时间 ",e.completed_time||"未完成"]},e.id))})})]},e.id))})]}),(0,r.jsx)("h2",{className:"text-xl font-bold mb-2",children:"已完成的项目"}),0===I.length?(0,r.jsx)("div",{className:"text-gray-500 mb-8",children:"暂无已完成项目"}):(0,r.jsxs)("table",{className:"table-auto w-full border-collapse border mb-8",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-100",children:[(0,r.jsx)("th",{className:"border px-2",children:"名称"}),(0,r.jsx)("th",{className:"border px-2",children:"集数"}),(0,r.jsx)("th",{className:"border px-2",children:"语言"}),(0,r.jsx)("th",{className:"border px-2",children:"分钟数"}),(0,r.jsx)("th",{className:"border px-2",children:"截止日期"}),(0,r.jsx)("th",{className:"border px-2",children:"验收时间"}),(0,r.jsx)("th",{className:"border px-2",children:"操作"})]})}),(0,r.jsx)("tbody",{children:I.map(e=>(0,r.jsxs)(n().Fragment,{children:[(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"border px-2",children:e.title}),(0,r.jsx)("td",{className:"border px-2",children:e.episode}),(0,r.jsx)("td",{className:"border px-2",children:e.language}),(0,r.jsx)("td",{className:"border px-2",children:e.minutes}),(0,r.jsx)("td",{className:"border px-2",children:e.deadline}),(0,r.jsx)("td",{className:"border px-2",children:new Date(e.accepted_time||Date.now()).toISOString().split("T")[0]}),(0,r.jsx)("td",{className:"border px-2",children:(0,r.jsx)("button",{className:"bg-blue-500 text-white px-2 py-1 rounded",onClick:()=>g(j===e.id?null:e.id),children:j===e.id?"收起":"展开"})})]}),j===e.id&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:7,className:"border px-2 bg-gray-50",children:e.assignments.map(e=>(0,r.jsxs)("div",{className:"text-sm mb-1",children:[(0,r.jsx)("strong",{children:e.role}),"：",e.member_name,"， 状态 ",e.status,"， 完成时间 ",e.completed_time||"未完成"]},e.id))})})]},e.id))})]}),(0,r.jsxs)("div",{className:"flex items-center mb-2",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mr-4",children:"新建项目"}),(0,r.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded",onClick:()=>f(e=>!e),children:v?"收起":"展开"})]}),v&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,r.jsx)("input",{placeholder:"项目名称",value:N.title,className:"border px-2 py-1",onChange:e=>y({...N,title:e.target.value})}),(0,r.jsx)("input",{placeholder:"集数",value:N.episode,className:"border px-2 py-1",onChange:e=>y({...N,episode:e.target.value})}),(0,r.jsxs)("select",{className:"border px-2 py-1",value:N.language,onChange:e=>y({...N,language:e.target.value}),children:[(0,r.jsx)("option",{value:"日语",children:"日语"}),(0,r.jsx)("option",{value:"英语",children:"英语"}),(0,r.jsx)("option",{value:"韩语",children:"韩语"})]}),(0,r.jsx)("input",{type:"number",placeholder:"分钟数",value:N.minutes||"",className:"border px-2 py-1",onChange:e=>y({...N,minutes:Number(e.target.value)})}),(0,r.jsx)("input",{type:"date",value:N.deadline,className:"border px-2 py-1",onChange:e=>y({...N,deadline:e.target.value})})]}),(0,r.jsx)("h3",{className:"font-bold",children:"任务分配"}),l.map(e=>(0,r.jsxs)("div",{className:"mb-2 flex items-center",children:[(0,r.jsxs)("span",{className:"w-16",children:[e,"："]}),(0,r.jsx)("input",{list:`${e}-list`,className:"border px-2 py-1 flex-1",placeholder:"输入姓名或用户名",value:P[e],onChange:async s=>{let t=s.target.value;w({...P,[e]:t}),await E(e,t);let r=C[e].find(e=>t===`${e.name}（${e.username}）`||t===e.username||t===e.name);y(s=>({...s,assignments:{...s.assignments,[e]:r?String(r.id):""}}))},onBlur:s=>{let t=s.target.value.trim();if(N.assignments[e])return void w(s=>({...s,[e]:t}));let r=C[e].find(e=>t===`${e.name}（${e.username}）`||t===e.username||t===e.name);r?(w(s=>({...s,[e]:t})),y(s=>({...s,assignments:{...s.assignments,[e]:String(r.id)}}))):(w(s=>({...s,[e]:""})),y(s=>({...s,assignments:{...s.assignments,[e]:""}})))}}),(0,r.jsx)("datalist",{id:`${e}-list`,children:C[e].map(e=>(0,r.jsx)("option",{value:`${e.name}（${e.username}）`},e.id))})]},e)),(0,r.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 mt-4",onClick:$,children:"创建项目"})]})]}):(0,r.jsx)("div",{children:"无访问权限"})}},85453:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,16444,23)),Promise.resolve().then(t.t.bind(t,16042,23)),Promise.resolve().then(t.t.bind(t,88170,23)),Promise.resolve().then(t.t.bind(t,49477,23)),Promise.resolve().then(t.t.bind(t,29345,23)),Promise.resolve().then(t.t.bind(t,12089,23)),Promise.resolve().then(t.t.bind(t,46577,23)),Promise.resolve().then(t.t.bind(t,31307,23))}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[243,278,658],()=>t(52765));module.exports=r})();