{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///E:/offer/bill-distribution-system/app/member/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useSession, signOut } from 'next-auth/react';\r\n\r\nexport default function MemberPage() {\r\n  const { data: session, status } = useSession();\r\n  const [pending, setPending] = useState<any[]>([]);\r\n  const [accepted, setAccepted] = useState<any[]>([]);\r\n  const [completed, setCompleted] = useState<any[]>([]);\r\n  const [skills, setSkills] = useState<any[]>([]);\r\n  const [availableMonths, setAvailableMonths] = useState<string[]>([]);\r\n  const [selectedMonth, setSelectedMonth] = useState<string>('');\r\n  const [loadError, setLoadError] = useState(false);\r\n\r\n  const fetchAssignments = async (month: string) => {\r\n    try {\r\n      const url = month ? `/api/member/assignments?month=${month}` : '/api/member/assignments';\r\n      const res = await fetch(url);\r\n      if (!res.ok) {\r\n        setLoadError(true);\r\n        return;\r\n      }\r\n      const data = await res.json();\r\n      setPending(data.pending);\r\n      setAccepted(data.accepted);\r\n      setCompleted(data.completed);\r\n      setSkills(data.skills);\r\n      setAvailableMonths(data.availableMonths);\r\n\r\n      if (!month && data.availableMonths.length > 0) {\r\n        setSelectedMonth(data.availableMonths[0]);\r\n      }\r\n\r\n      setLoadError(false);\r\n    } catch {\r\n      setLoadError(true);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (session?.user?.role === 'member') {\r\n      fetchAssignments(selectedMonth);\r\n    }\r\n  }, [session, selectedMonth]);\r\n\r\n  const updateAssignment = async (id: number, action: string, confirmText: string) => {\r\n    const ok = confirm(confirmText);\r\n    if (!ok) return;\r\n    const res = await fetch('/api/member/assignments', {\r\n      method: 'PATCH',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ assignmentId: id, action }),\r\n    });\r\n    if (res.ok) fetchAssignments(selectedMonth);\r\n    else alert('操作失败，请稍后再试');\r\n  };\r\n\r\n  if (status === 'loading') return <div>加载中...</div>;\r\n  if (!session || session.user.role !== 'member') return <div>无访问权限</div>;\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-10\">\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <div>\r\n          当前登录：<strong>{session.user.name}</strong>（接单员）\r\n        </div>\r\n        <button\r\n          className=\"bg-red-500 text-white px-4 py-2 rounded\"\r\n          onClick={() => signOut({ callbackUrl: '/login' })}\r\n        >\r\n          退出登录\r\n        </button>\r\n      </div>\r\n\r\n      {loadError && (\r\n        <div className=\"text-red-600 mb-4\">⚠️ 加载任务失败，请稍后刷新页面</div>\r\n      )}\r\n\r\n      {/* 技能信息 */}\r\n      <div>\r\n        <h2 className=\"text-xl font-bold mb-2\">个人技能</h2>\r\n        {skills.length === 0 ? (\r\n          <p className=\"text-gray-500\">尚未填写技能信息</p>\r\n        ) : (\r\n          <table className=\"table-auto w-full border-collapse border mb-6\">\r\n            <thead>\r\n              <tr className=\"bg-gray-100\">\r\n                <th className=\"border px-2\">语言</th>\r\n                <th className=\"border px-2\">任务类型</th>\r\n                <th className=\"border px-2\">单价</th>\r\n                <th className=\"border px-2\">评级</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {skills.map((s, idx) => (\r\n                <tr key={idx}>\r\n                  <td className=\"border px-2\">{s.language}</td>\r\n                  <td className=\"border px-2\">{s.task}</td>\r\n                  <td className=\"border px-2\">{s.price}</td>\r\n                  <td className=\"border px-2\">{s.rating}</td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        )}\r\n      </div>\r\n\r\n      {/* 待接受任务 */}\r\n      <div>\r\n        <h2 className=\"text-xl font-bold mb-2\">待接受的任务</h2>\r\n        {pending.length === 0 ? (\r\n          <p className=\"mb-6 text-gray-500\">暂无待接受任务</p>\r\n        ) : (\r\n          <table className=\"table-auto w-full border-collapse border mb-8\">\r\n            <thead>\r\n              <tr className=\"bg-gray-100\">\r\n                <th className=\"border px-2\">项目名</th>\r\n                <th className=\"border px-2\">语言</th>\r\n                <th className=\"border px-2\">分钟数</th>\r\n                <th className=\"border px-2\">截止日期</th>\r\n                <th className=\"border px-2\">操作</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {pending.map((a) => (\r\n                <tr key={a.id}>\r\n                  <td className=\"border px-2\">{a.title}</td>\r\n                  <td className=\"border px-2\">{a.language}</td>\r\n                  <td className=\"border px-2\">{a.project_minutes}</td>\r\n                  <td className=\"border px-2\">{a.deadline}</td>\r\n                  <td className=\"border px-2 space-x-2\">\r\n                    <button\r\n                      className=\"bg-green-600 text-white px-2 py-1 rounded\"\r\n                      onClick={() => updateAssignment(a.id, 'accept', '确认接受该任务？')}\r\n                    >\r\n                      接受\r\n                    </button>\r\n                    <button\r\n                      className=\"bg-red-500 text-white px-2 py-1 rounded\"\r\n                      onClick={() => updateAssignment(a.id, 'reject', '确认拒绝该任务？')}\r\n                    >\r\n                      拒绝\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        )}\r\n      </div>\r\n\r\n      {/* 已接受任务 */}\r\n      <div>\r\n        <h2 className=\"text-xl font-bold mb-2\">进行中的任务</h2>\r\n        {accepted.length === 0 ? (\r\n          <p className=\"text-gray-500\">暂无进行中的任务</p>\r\n        ) : (\r\n          <table className=\"table-auto w-full border-collapse border mb-8\">\r\n            <thead>\r\n              <tr className=\"bg-gray-100\">\r\n                <th className=\"border px-2\">项目名</th>\r\n                <th className=\"border px-2\">语言</th>\r\n                <th className=\"border px-2\">分钟数</th>\r\n                <th className=\"border px-2\">截止日期</th>\r\n                <th className=\"border px-2\">状态</th>\r\n                <th className=\"border px-2\">操作</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {accepted.map((a) => (\r\n                <tr key={a.id}>\r\n                  <td className=\"border px-2\">{a.title}</td>\r\n                  <td className=\"border px-2\">{a.language}</td>\r\n                  <td className=\"border px-2\">{a.project_minutes}</td>\r\n                  <td className=\"border px-2\">{a.deadline}</td>\r\n                  <td className=\"border px-2\">{a.status}</td>\r\n                  <td className=\"border px-2\">\r\n                    <button\r\n                      className=\"bg-blue-600 text-white px-2 py-1 rounded\"\r\n                      onClick={() => updateAssignment(a.id, 'complete', '确认已完成该任务？')}\r\n                    >\r\n                      确认完成\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        )}\r\n      </div>\r\n\r\n      {/* 已完成任务 */}\r\n      <div>\r\n        <div className=\"flex items-center gap-4 mb-2\">\r\n          <h2 className=\"text-xl font-bold\">已完成的任务</h2>\r\n          {availableMonths.length > 0 && (\r\n            <select\r\n              className=\"border px-2 py-1 rounded\"\r\n              value={selectedMonth}\r\n              onChange={(e) => setSelectedMonth(e.target.value)}\r\n            >\r\n              {availableMonths.map((m) => (\r\n                <option key={m} value={m}>\r\n                  {m}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          )}\r\n        </div>\r\n        {availableMonths.length === 0 ? (\r\n          <p className=\"text-gray-500\">暂无已完成任务</p>\r\n        ) : completed.length === 0 ? (\r\n          <p className=\"text-gray-500\">该月无已完成任务</p>\r\n        ) : (\r\n          <table className=\"table-auto w-full border-collapse border\">\r\n            <thead>\r\n              <tr className=\"bg-gray-100\">\r\n                <th className=\"border px-2\">项目名</th>\r\n                <th className=\"border px-2\">语言</th>\r\n                <th className=\"border px-2\">分钟数</th>\r\n                <th className=\"border px-2\">完成时间</th>\r\n                <th className=\"border px-2\">备注</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {completed.map((a) => (\r\n                <tr key={a.id}>\r\n                  <td className=\"border px-2\">{a.title}</td>\r\n                  <td className=\"border px-2\">{a.language}</td>\r\n                  <td className=\"border px-2\">{a.project_minutes}</td>\r\n                  <td className=\"border px-2\">{a.completed_time}</td>\r\n                  <td className=\"border px-2\">{a.deduction_note || '无'}</td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}